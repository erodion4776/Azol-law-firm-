<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Page Editor - CY visa help Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #0a2342;
            --accent-color: #d4af37;
            --light-bg: #f9f9f9;
            --white: #ffffff;
            --text-dark: #333333;
            --text-light: #666666;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: var(--light-bg);
            color: var(--text-dark);
        }

        /* Admin Header */
        .admin-header {
            background: var(--white);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .admin-header-content {
            max-width: 100%;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .back-btn {
            padding: 0.6rem 1.2rem;
            background: var(--light-bg);
            color: var(--text-dark);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .back-btn:hover {
            background: var(--primary-color);
            color: var(--white);
        }

        .page-title-header {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .btn-save, .btn-preview, .btn-publish {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-save {
            background: var(--info-color);
            color: var(--white);
        }

        .btn-save:hover {
            background: #138496;
        }

        .btn-preview {
            background: var(--warning-color);
            color: var(--text-dark);
        }

        .btn-preview:hover {
            background: #e0a800;
        }

        .btn-publish {
            background: var(--success-color);
            color: var(--white);
        }

        .btn-publish:hover {
            background: #218838;
        }

        /* Editor Layout */
        .editor-container {
            display: flex;
            height: calc(100vh - 70px);
        }

        /* Sidebar */
        .editor-sidebar {
            width: 300px;
            background: var(--white);
            border-right: 1px solid #e0e0e0;
            overflow-y: auto;
        }

        .sidebar-tabs {
            display: flex;
            border-bottom: 2px solid #e0e0e0;
        }

        .sidebar-tab {
            flex: 1;
            padding: 1rem;
            background: var(--light-bg);
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .sidebar-tab.active {
            background: var(--white);
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
        }

        .sidebar-content {
            padding: 1.5rem;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* Form Groups */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Roboto', sans-serif;
            font-size: 0.95rem;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Components Panel */
        .components-list {
            display: grid;
            gap: 1rem;
        }

        .component-item {
            padding: 1rem;
            background: var(--light-bg);
            border: 2px dashed #ccc;
            border-radius: 8px;
            cursor: move;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .component-item:hover {
            background: var(--white);
            border-color: var(--accent-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .component-icon {
            width: 50px;
            height: 50px;
            background: var(--accent-color);
            color: var(--white);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .component-info h4 {
            color: var(--primary-color);
            margin-bottom: 0.3rem;
        }

        .component-info p {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        /* SEO Panel */
        .seo-preview {
            background: var(--light-bg);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .seo-preview h4 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .google-preview {
            background: var(--white);
            padding: 1rem;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .preview-url {
            color: #006621;
            font-size: 0.85rem;
            margin-bottom: 0.3rem;
        }

        .preview-title {
            color: #1a0dab;
            font-size: 1.1rem;
            font-weight: 500;
            margin-bottom: 0.3rem;
        }

        .preview-description {
            color: #545454;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .char-count {
            font-size: 0.85rem;
            color: var(--text-light);
            text-align: right;
            margin-top: 0.3rem;
        }

        .char-count.warning {
            color: var(--warning-color);
        }

        .char-count.error {
            color: var(--danger-color);
        }

        /* Main Editor Area */
        .editor-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .editor-toolbar {
            background: var(--white);
            border-bottom: 1px solid #e0e0e0;
            padding: 1rem 1.5rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .toolbar-group {
            display: flex;
            gap: 0.3rem;
            padding-right: 1rem;
            border-right: 1px solid #e0e0e0;
        }

        .toolbar-group:last-child {
            border-right: none;
        }

        .toolbar-btn {
            width: 35px;
            height: 35px;
            border: 1px solid #ddd;
            background: var(--white);
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--text-dark);
        }

        .toolbar-btn:hover {
            background: var(--accent-color);
            color: var(--white);
            border-color: var(--accent-color);
        }

        .toolbar-btn.active {
            background: var(--primary-color);
            color: var(--white);
            border-color: var(--primary-color);
        }

        .editor-workspace {
            flex: 1;
            overflow-y: auto;
            padding: 2rem;
            background: #f0f0f0;
        }

        .page-canvas {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--white);
            min-height: 600px;
            border-radius: 10px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.1);
        }

        /* Code Editor */
        .code-editor {
            width: 100%;
            height: 500px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #1e1e1e;
            color: #d4d4d4;
        }

        /* Visual Editor */
        .visual-editor {
            width: 100%;
            min-height: 500px;
            padding: 2rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: var(--white);
            outline: none;
        }

        .visual-editor:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        /* Editor Mode Toggle */
        .editor-mode-toggle {
            display: flex;
            background: var(--light-bg);
            padding: 0.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .mode-btn {
            flex: 1;
            padding: 0.7rem;
            background: transparent;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .mode-btn.active {
            background: var(--white);
            color: var(--accent-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Media Library */
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1rem;
        }

        .media-item {
            position: relative;
            aspect-ratio: 1;
            background: var(--light-bg);
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .media-item:hover {
            border-color: var(--accent-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .media-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .media-item-placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-size: 2rem;
            color: var(--text-light);
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 8px;
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 2rem;
        }

        .upload-area:hover {
            border-color: var(--accent-color);
            background: rgba(212, 175, 55, 0.05);
        }

        .upload-area i {
            font-size: 3rem;
            color: var(--accent-color);
            margin-bottom: 1rem;
        }

        /* Success/Error Messages */
        .message {
            position: fixed;
            top: 80px;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 2000;
            display: none;
            align-items: center;
            gap: 1rem;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .message.show {
            display: flex;
        }

        .message.success {
            background: var(--success-color);
            color: var(--white);
        }

        .message.error {
            background: var(--danger-color);
            color: var(--white);
        }

        .message.warning {
            background: var(--warning-color);
            color: var(--text-dark);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .editor-sidebar {
                width: 250px;
            }
        }

        @media (max-width: 768px) {
            .editor-container {
                flex-direction: column;
            }

            .editor-sidebar {
                width: 100%;
                height: auto;
                max-height: 50vh;
            }

            .editor-toolbar {
                padding: 0.5rem;
            }

            .toolbar-group {
                padding-right: 0.5rem;
            }

            .header-actions {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- Admin Header -->
    <header class="admin-header">
        <div class="admin-header-content">
            <div class="header-left">
                <a href="admin-dashboard.html" class="back-btn">
                    <i class="fas fa-arrow-left"></i> Back to Dashboard
                </a>
                <h1 class="page-title-header" id="pageTitle">Page Editor</h1>
            </div>
            <div class="header-actions">
                <button class="btn-save" id="saveBtn">
                    <i class="fas fa-save"></i> Save Draft
                </button>
                <button class="btn-preview" id="previewBtn">
                    <i class="fas fa-eye"></i> Preview
                </button>
                <button class="btn-publish" id="publishBtn">
                    <i class="fas fa-upload"></i> Publish
                </button>
            </div>
        </div>
    </header>

    <!-- Editor Container -->
    <div class="editor-container">
        <!-- Sidebar -->
        <aside class="editor-sidebar">
            <div class="sidebar-tabs">
                <button class="sidebar-tab active" data-tab="settings">
                    <i class="fas fa-cog"></i> Settings
                </button>
                <button class="sidebar-tab" data-tab="components">
                    <i class="fas fa-th"></i> Blocks
                </button>
                <button class="sidebar-tab" data-tab="seo">
                    <i class="fas fa-search"></i> SEO
                </button>
            </div>

            <div class="sidebar-content">
                <!-- Settings Tab -->
                <div class="tab-panel active" id="settings-panel">
                    <div class="form-group">
                        <label for="pageNameInput">
                            <i class="fas fa-file"></i> Page Name
                        </label>
                        <input type="text" id="pageNameInput" placeholder="e.g., About Us">
                    </div>

                    <div class="form-group">
                        <label for="pageUrlInput">
                            <i class="fas fa-link"></i> Page URL
                        </label>
                        <input type="text" id="pageUrlInput" placeholder="e.g., about.html">
                    </div>

                    <div class="form-group">
                        <label for="pageStatusSelect">
                            <i class="fas fa-toggle-on"></i> Status
                        </label>
                        <select id="pageStatusSelect">
                            <option value="draft">Draft</option>
                            <option value="published" selected>Published</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="pageTemplateSelect">
                            <i class="fas fa-layer-group"></i> Template
                        </label>
                        <select id="pageTemplateSelect">
                            <option value="default">Default</option>
                            <option value="full-width">Full Width</option>
                            <option value="landing">Landing Page</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="pageFeaturedImage">
                            <i class="fas fa-image"></i> Featured Image
                        </label>
                        <input type="file" id="pageFeaturedImage" accept="image/*">
                    </div>
                </div>

                <!-- Components Tab -->
                <div class="tab-panel" id="components-panel">
                    <h4 style="margin-bottom: 1rem; color: var(--primary-color);">
                        <i class="fas fa-puzzle-piece"></i> Drag & Drop Components
                    </h4>
                    <div class="components-list">
                        <div class="component-item" draggable="true" data-component="hero">
                            <div class="component-icon">
                                <i class="fas fa-desktop"></i>
                            </div>
                            <div class="component-info">
                                <h4>Hero Section</h4>
                                <p>Large banner with title</p>
                            </div>
                        </div>

                        <div class="component-item" draggable="true" data-component="text">
                            <div class="component-icon">
                                <i class="fas fa-align-left"></i>
                            </div>
                            <div class="component-info">
                                <h4>Text Block</h4>
                                <p>Paragraph content</p>
                            </div>
                        </div>

                        <div class="component-item" draggable="true" data-component="image">
                            <div class="component-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="component-info">
                                <h4>Image</h4>
                                <p>Single image</p>
                            </div>
                        </div>

                        <div class="component-item" draggable="true" data-component="gallery">
                            <div class="component-icon">
                                <i class="fas fa-images"></i>
                            </div>
                            <div class="component-info">
                                <h4>Image Gallery</h4>
                                <p>Grid of images</p>
                            </div>
                        </div>

                        <div class="component-item" draggable="true" data-component="testimonial">
                            <div class="component-icon">
                                <i class="fas fa-quote-left"></i>
                            </div>
                            <div class="component-info">
                                <h4>Testimonial</h4>
                                <p>Client review</p>
                            </div>
                        </div>

                        <div class="component-item" draggable="true" data-component="cta">
                            <div class="component-icon">
                                <i class="fas fa-bullhorn"></i>
                            </div>
                            <div class="component-info">
                                <h4>Call to Action</h4>
                                <p>Button with text</p>
                            </div>
                        </div>

                        <div class="component-item" draggable="true" data-component="form">
                            <div class="component-icon">
                                <i class="fas fa-wpforms"></i>
                            </div>
                            <div class="component-info">
                                <h4>Contact Form</h4>
                                <p>Input fields</p>
                            </div>
                        </div>

                        <div class="component-item" draggable="true" data-component="columns">
                            <div class="component-icon">
                                <i class="fas fa-columns"></i>
                            </div>
                            <div class="component-info">
                                <h4>Columns</h4>
                                <p>Multi-column layout</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SEO Tab -->
                <div class="tab-panel" id="seo-panel">
                    <div class="seo-preview">
                        <h4><i class="fas fa-google"></i> Google Preview</h4>
                        <div class="google-preview">
                            <div class="preview-url" id="seoPreviewUrl">
                                https://cyvisahelp.com/page-name
                            </div>
                            <div class="preview-title" id="seoPreviewTitle">
                                Your Page Title - CY visa help
                            </div>
                            <div class="preview-description" id="seoPreviewDesc">
                                Your meta description will appear here. Make it compelling and informative to encourage clicks.
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="metaTitleInput">
                            <i class="fas fa-heading"></i> Meta Title
                        </label>
                        <input type="text" id="metaTitleInput" placeholder="Page Title - CY visa help" maxlength="60">
                        <div class="char-count" id="titleCharCount">0 / 60 characters</div>
                    </div>

                    <div class="form-group">
                        <label for="metaDescInput">
                            <i class="fas fa-align-left"></i> Meta Description
                        </label>
                        <textarea id="metaDescInput" placeholder="Describe your page content..." maxlength="160"></textarea>
                        <div class="char-count" id="descCharCount">0 / 160 characters</div>
                    </div>

                    <div class="form-group">
                        <label for="metaKeywordsInput">
                            <i class="fas fa-tags"></i> Keywords
                        </label>
                        <input type="text" id="metaKeywordsInput" placeholder="visa, immigration, help">
                    </div>

                    <div class="form-group">
                        <label for="ogImageInput">
                            <i class="fab fa-facebook"></i> Social Share Image
                        </label>
                        <input type="file" id="ogImageInput" accept="image/*">
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Editor -->
        <main class="editor-main">
            <!-- Toolbar -->
            <div class="editor-toolbar">
                <div class="toolbar-group">
                    <button class="toolbar-btn" title="Bold" data-command="bold">
                        <i class="fas fa-bold"></i>
                    </button>
                    <button class="toolbar-btn" title="Italic" data-command="italic">
                        <i class="fas fa-italic"></i>
                    </button>
                    <button class="toolbar-btn" title="Underline" data-command="underline">
                        <i class="fas fa-underline"></i>
                    </button>
                </div>

                <div class="toolbar-group">
                    <button class="toolbar-btn" title="Align Left" data-command="justifyLeft">
                        <i class="fas fa-align-left"></i>
                    </button>
                    <button class="toolbar-btn" title="Align Center" data-command="justifyCenter">
                        <i class="fas fa-align-center"></i>
                    </button>
                    <button class="toolbar-btn" title="Align Right" data-command="justifyRight">
                        <i class="fas fa-align-right"></i>
                    </button>
                </div>

                <div class="toolbar-group">
                    <button class="toolbar-btn" title="Insert Link" data-command="createLink">
                        <i class="fas fa-link"></i>
                    </button>
                    <button class="toolbar-btn" title="Insert Image" data-command="insertImage">
                        <i class="fas fa-image"></i>
                    </button>
                </div>

                <div class="toolbar-group">
                    <button class="toolbar-btn" title="Ordered List" data-command="insertOrderedList">
                        <i class="fas fa-list-ol"></i>
                    </button>
                    <button class="toolbar-btn" title="Unordered List" data-command="insertUnorderedList">
                        <i class="fas fa-list-ul"></i>
                    </button>
                </div>

                <div class="toolbar-group">
                    <button class="toolbar-btn" title="Undo" data-command="undo">
                        <i class="fas fa-undo"></i>
                    </button>
                    <button class="toolbar-btn" title="Redo" data-command="redo">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
            </div>

            <!-- Editor Workspace -->
            <div class="editor-workspace">
                <div class="editor-mode-toggle">
                    <button class="mode-btn active" id="visualModeBtn">
                        <i class="fas fa-eye"></i> Visual Editor
                    </button>
                    <button class="mode-btn" id="codeModeBtn">
                        <i class="fas fa-code"></i> Code Editor
                    </button>
                </div>

                <div class="page-canvas">
                    <!-- Visual Editor -->
                    <div id="visualEditor" class="visual-editor" contenteditable="true">
                        <h1>Welcome to Your New Page</h1>
                        <p>Start editing this content or drag components from the sidebar to build your page.</p>
                        <p>You can format text, add images, create lists, and much more using the toolbar above.</p>
                    </div>

                    <!-- Code Editor -->
                    <textarea id="codeEditor" class="code-editor" style="display: none;">
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>New Page</title>
</head>
<body>
    <h1>Welcome to Your New Page</h1>
    <p>Start editing this content...</p>
</body>
</html>
                    </textarea>
                </div>
            </div>
        </main>
    </div>

    <!-- Success/Error Messages -->
    <div class="message success" id="successMessage">
        <i class="fas fa-check-circle"></i>
        <span id="successText">Changes saved successfully!</span>
    </div>

    <div class="message error" id="errorMessage">
        <i class="fas fa-exclamation-circle"></i>
        <span id="errorText">An error occurred. Please try again.</span>
    </div>

    <script>
        // Check authentication
        function checkAuth() {
            const sessionData = sessionStorage.getItem('adminSession') || localStorage.getItem('adminSession');
            
            if (!sessionData) {
                window.location.href = 'admin-login.html';
                return false;
            }

            try {
                const session = JSON.parse(sessionData);
                if (!session.isAuthenticated) {
                    window.location.href = 'admin-login.html';
                    return false;
                }
                return true;
            } catch (e) {
                window.location.href = 'admin-login.html';
                return false;
            }
        }

        // Initialize editor
        window.addEventListener('load', () => {
            if (!checkAuth()) return;

            initializeSidebarTabs();
            initializeToolbar();
            initializeEditorMode();
            initializeSEOPreview();
            initializeComponentDragDrop();
            initializeSaveButtons();
            loadPageData();
        });

        // Sidebar tabs
        function initializeSidebarTabs() {
            const tabs = document.querySelectorAll('.sidebar-tab');
            const panels = document.querySelectorAll('.tab-panel');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;

                    tabs.forEach(t => t.classList.remove('active'));
                    panels.forEach(p => p.classList.remove('active'));

                    tab.classList.add('active');
                    document.getElementById(`${targetTab}-panel`).classList.add('active');
                });
            });
        }

        // Toolbar functionality
        function initializeToolbar() {
            const toolbarBtns = document.querySelectorAll('.toolbar-btn');

            toolbarBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const command = btn.dataset.command;

                    if (command === 'createLink') {
                        const url = prompt('Enter URL:');
                        if (url) document.execCommand(command, false, url);
                    } else if (command === 'insertImage') {
                        const url = prompt('Enter image URL:');
                        if (url) document.execCommand(command, false, url);
                    } else {
                        document.execCommand(command, false, null);
                    }
                });
            });
        }

        // Editor mode toggle
        function initializeEditorMode() {
            const visualModeBtn = document.getElementById('visualModeBtn');
            const codeModeBtn = document.getElementById('codeModeBtn');
            const visualEditor = document.getElementById('visualEditor');
            const codeEditor = document.getElementById('codeEditor');

            visualModeBtn.addEventListener('click', () => {
                visualModeBtn.classList.add('active');
                codeModeBtn.classList.remove('active');
                codeEditor.style.display = 'none';
                visualEditor.style.display = 'block';
                
                // Sync content from code to visual
                visualEditor.innerHTML = codeEditor.value;
            });

            codeModeBtn.addEventListener('click', () => {
                codeModeBtn.classList.add('active');
                visualModeBtn.classList.remove('active');
                visualEditor.style.display = 'none';
                codeEditor.style.display = 'block';
                
                // Sync content from visual to code
                codeEditor.value = visualEditor.innerHTML;
            });
        }

        // SEO Preview
        function initializeSEOPreview() {
            const metaTitleInput = document.getElementById('metaTitleInput');
            const metaDescInput = document.getElementById('metaDescInput');
            const pageUrlInput = document.getElementById('pageUrlInput');

            metaTitleInput.addEventListener('input', updateSEOPreview);
            metaDescInput.addEventListener('input', updateSEOPreview);
            pageUrlInput.addEventListener('input', updateSEOPreview);

            function updateSEOPreview() {
                const title = metaTitleInput.value || 'Your Page Title - CY visa help';
                const desc = metaDescInput.value || 'Your meta description will appear here...';
                const url = pageUrlInput.value || 'page-name';

                document.getElementById('seoPreviewTitle').textContent = title;
                document.getElementById('seoPreviewDesc').textContent = desc;
                document.getElementById('seoPreviewUrl').textContent = `https://cyvisahelp.com/${url}`;

                // Update character counts
                const titleCount = metaTitleInput.value.length;
                const descCount = metaDescInput.value.length;

                const titleCharCount = document.getElementById('titleCharCount');
                const descCharCount = document.getElementById('descCharCount');

                titleCharCount.textContent = `${titleCount} / 60 characters`;
                descCharCount.textContent = `${descCount} / 160 characters`;

                // Color coding
                titleCharCount.className = 'char-count';
                if (titleCount > 60) titleCharCount.classList.add('error');
                else if (titleCount > 50) titleCharCount.classList.add('warning');

                descCharCount.className = 'char-count';
                if (descCount > 160) descCharCount.classList.add('error');
                else if (descCount > 140) descCharCount.classList.add('warning');
            }
        }

        // Component Drag & Drop
        function initializeComponentDragDrop() {
            const components = document.querySelectorAll('.component-item');
            const visualEditor = document.getElementById('visualEditor');

            components.forEach(component => {
                component.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('component', component.dataset.component);
                });
            });

            visualEditor.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            visualEditor.addEventListener('drop', (e) => {
                e.preventDefault();
                const componentType = e.dataTransfer.getData('component');
                insertComponent(componentType);
            });
        }

        function insertComponent(type) {
            const visualEditor = document.getElementById('visualEditor');
            let html = '';

            switch(type) {
                case 'hero':
                    html = '<div style="background: linear-gradient(135deg, #0a2342, #0d3a66); color: white; padding: 4rem 2rem; text-align: center; border-radius: 10px; margin: 1rem 0;"><h1>Hero Title</h1><p>Hero description text</p></div>';
                    break;
                case 'text':
                    html = '<p>This is a new text block. Click to edit.</p>';
                    break;
                case 'image':
                    html = '<img src="https://via.placeholder.com/800x400" alt="Placeholder" style="max-width: 100%; border-radius: 10px; margin: 1rem 0;">';
                    break;
                case 'testimonial':
                    html = '<blockquote style="border-left: 4px solid #d4af37; padding-left: 1rem; font-style: italic; margin: 1rem 0;">"This is a testimonial quote." - Client Name</blockquote>';
                    break;
                case 'cta':
                    html = '<div style="text-align: center; margin: 2rem 0;"><a href="#" style="display: inline-block; padding: 1rem 2rem; background: #d4af37; color: white; text-decoration: none; border-radius: 50px;">Click Here</a></div>';
                    break;
                default:
                    html = `<div style="padding: 1rem; border: 2px dashed #ccc; margin: 1rem 0;">${type} component</div>`;
            }

            visualEditor.innerHTML += html;
            showMessage('Component added successfully!', 'success');
        }

        // Save buttons
        function initializeSaveButtons() {
            document.getElementById('saveBtn').addEventListener('click', () => savePage('draft'));
            document.getElementById('publishBtn').addEventListener('click', () => savePage('published'));
            document.getElementById('previewBtn').addEventListener('click', previewPage);
        }

        function savePage(status) {
            const pageData = {
                name: document.getElementById('pageNameInput').value,
                url: document.getElementById('pageUrlInput').value,
                status: status,
                content: document.getElementById('visualEditor').innerHTML,
                metaTitle: document.getElementById('metaTitleInput').value,
                metaDescription: document.getElementById('metaDescInput').value,
                metaKeywords: document.getElementById('metaKeywordsInput').value,
                template: document.getElementById('pageTemplateSelect').value,
                savedAt: new Date().toISOString()
            };

            // Save to localStorage (in production, send to backend)
            localStorage.setItem(`page_${pageData.url}`, JSON.stringify(pageData));
            
            const message = status === 'published' ? 'Page published successfully!' : 'Draft saved successfully!';
            showMessage(message, 'success');
        }

        function previewPage() {
            const content = document.getElementById('visualEditor').innerHTML;
            const previewWindow = window.open('', '_blank');
            previewWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Preview</title>
                    <style>
                        body { font-family: 'Roboto', sans-serif; padding: 2rem; max-width: 1200px; margin: 0 auto; }
                    </style>
                </head>
                <body>${content}</body>
                </html>
            `);
        }

        function loadPageData() {
            const urlParams = new URLSearchParams(window.location.search);
            const pageUrl = urlParams.get('page');

            if (pageUrl) {
                const pageData = localStorage.getItem(`page_${pageUrl}`);
                if (pageData) {
                    const data = JSON.parse(pageData);
                    document.getElementById('pageNameInput').value = data.name || '';
                    document.getElementById('pageUrlInput').value = data.url || '';
                    document.getElementById('pageStatusSelect').value = data.status || 'draft';
                    document.getElementById('visualEditor').innerHTML = data.content || '';
                    document.getElementById('metaTitleInput').value = data.metaTitle || '';
                    document.getElementById('metaDescInput').value = data.metaDescription || '';
                    document.getElementById('metaKeywordsInput').value = data.metaKeywords || '';
                    document.getElementById('pageTemplateSelect').value = data.template || 'default';
                }
            }
        }

        function showMessage(text, type) {
            const message = document.getElementById(type === 'success' ? 'successMessage' : 'errorMessage');
            const textSpan = document.getElementById(type === 'success' ? 'successText' : 'errorText');
            
            textSpan.textContent = text;
            message.classList.add('show');

            setTimeout(() => {
                message.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
